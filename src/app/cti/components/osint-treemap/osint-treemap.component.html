<div class="chart-container">
  <div class="chart-header">
    <h3>Sources OSINT</h3>
    <div class="chart-actions">
      <button mat-icon-button (click)="refreshData()" matTooltip="Rafraîchir">
        <mat-icon>refresh</mat-icon>
      </button>
      <button mat-icon-button matTooltip="Plein écran">
        <mat-icon>fullscreen</mat-icon>
      </button>
    </div>
  </div>

  <div class="chart-filters">
    <div class="filter-section">
      <h4>Catégories</h4>
      <div class="filter-options">
        <div class="filter-option" 
             [class.active]="selectedCategories.includes('Social Media')"
             (click)="toggleCategory('Social Media')">
          <mat-icon>public</mat-icon>
          <span>Social Media</span>
        </div>
        <div class="filter-option" 
             [class.active]="selectedCategories.includes('Government')"
             (click)="toggleCategory('Government')">
          <mat-icon>account_balance</mat-icon>
          <span>Government</span>
        </div>
        <div class="filter-option" 
             [class.active]="selectedCategories.includes('Security Vendors')"
             (click)="toggleCategory('Security Vendors')">
          <mat-icon>security</mat-icon>
          <span>Security Vendors</span>
        </div>
        <div class="filter-option" 
             [class.active]="selectedCategories.includes('Dark Web')"
             (click)="toggleCategory('Dark Web')">
          <mat-icon>vpn_lock</mat-icon>
          <span>Dark Web</span>
        </div>
        <div class="filter-option" 
             [class.active]="selectedCategories.includes('Research')"
             (click)="toggleCategory('Research')">
          <mat-icon>school</mat-icon>
          <span>Research</span>
        </div>
      </div>
    </div>

    <div class="filter-section">
      <h4>Fiabilité</h4>
      <div class="filter-options">
        <div class="filter-option" 
             [class.active]="selectedReliabilities.includes('high')"
             (click)="toggleReliability('high')">
          <div class="reliability-indicator high"></div>
          <span>Haute</span>
        </div>
        <div class="filter-option" 
             [class.active]="selectedReliabilities.includes('medium')"
             (click)="toggleReliability('medium')">
          <div class="reliability-indicator medium"></div>
          <span>Moyenne</span>
        </div>
        <div class="filter-option" 
             [class.active]="selectedReliabilities.includes('low')"
             (click)="toggleReliability('low')">
          <div class="reliability-indicator low"></div>
          <span>Basse</span>
        </div>
      </div>
    </div>

    <div class="filter-section search-section">
      <h4>Recherche</h4>
      <div class="search-input">
        <input type="text" 
               placeholder="Rechercher une source..." 
               [(ngModel)]="searchTerm"
               (input)="applySearch(searchTerm)">
        <mat-icon>search</mat-icon>
      </div>
    </div>
  </div>

  <div class="chart-content">
    <div *ngIf="loading" class="loading-container">
      <mat-icon class="loading-icon">radar</mat-icon>
      <p>Chargement des données OSINT...</p>
    </div>
    <div #treemapContainer class="treemap-container" [hidden]="loading"></div>
  </div>

  <div class="chart-footer">
    <div class="treemap-legend">
      <div class="legend-section">
        <h5>Catégories</h5>
        <div class="legend-items">
          <div class="legend-item social-media">
            <div class="legend-color"></div>
            <div class="legend-label">Social Media</div>
          </div>
          <div class="legend-item government">
            <div class="legend-color"></div>
            <div class="legend-label">Government</div>
          </div>
          <div class="legend-item vendors">
            <div class="legend-color"></div>
            <div class="legend-label">Security Vendors</div>
          </div>
          <div class="legend-item dark-web">
            <div class="legend-color"></div>
            <div class="legend-label">Dark Web</div>
          </div>
          <div class="legend-item research">
            <div class="legend-color"></div>
            <div class="legend-label">Research</div>
          </div>
        </div>
      </div>
      
      <div class="legend-section">
        <h5>Fiabilité</h5>
        <div class="legend-items">
          <div class="legend-item">
            <div class="reliability-indicator high"></div>
            <div class="legend-label">Haute</div>
          </div>
          <div class="legend-item">
            <div class="reliability-indicator medium"></div>
            <div class="legend-label">Moyenne</div>
          </div>
          <div class="legend-item">
            <div class="reliability-indicator low"></div>
            <div class="legend-label">Basse</div>
          </div>
        </div>
      </div>
    </div>
    <div class="chart-info">
      <span>Cliquez sur une source pour plus de détails</span>
    </div>
  </div>
</div>
